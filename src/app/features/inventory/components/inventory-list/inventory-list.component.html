<div class="retail-pro-container">
  <!-- Download Loading Overlay -->
  <div *ngIf="downloadLoading()" class="download-loading-overlay">
    <div class="loading-content">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Downloading template...</p>
    </div>
  </div>

  <!-- Header Section with Search -->
  <div class="retail-pro-page-header">
    <div class="retail-pro-header-top">
      <h1 class="retail-pro-page-title">Products</h1>
      <div class="header-actions">
        <button class="retail-pro-btn retail-pro-btn--secondary" (click)="downloadTemplate()" title="Download Excel Template">
          <mat-icon>download</mat-icon>
          Template
        </button>
        <button class="retail-pro-btn retail-pro-btn--secondary" (click)="openUploadModal()" title="Upload Products from Excel">
          <mat-icon>upload</mat-icon>
          Import Products
        </button>
        <!-- <button class="retail-pro-btn retail-pro-btn--secondary" (click)="exportProducts()" title="Export Products to Excel">
          <mat-icon>file_download</mat-icon>
          Export Products
        </button> -->
        <button class="retail-pro-btn retail-pro-btn--primary" (click)="navigateAddProduct()">
          <span class="btn-icon">+</span>
          Add Product
        </button>
      </div>
    </div>
    <div class="retail-pro-search-bar">
      <input 
        type="text" 
        placeholder="Search products..." 
        class="retail-pro-input retail-pro-input--full-width"
        [(ngModel)]="searchTerm"
        (input)="onSearch()">
      <button class="retail-pro-btn retail-pro-btn--secondary" (click)="onSearch()">Search</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="retail-pro-loading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading products...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error()" class="retail-pro-error">
    <mat-icon>warning</mat-icon>
    <p>{{ getErrorMessage() }}</p>
  </div>

  <!-- Products Table -->
  <div *ngIf="!loading() && filteredItems().length" class="table-container">
    <table class="product-table">
      <thead>
        <tr>
          <th>Product Name</th>
          <th>Description</th>
          <th>Barcode</th>
          <th>Price</th>
          <th>MRP</th>
          <th>Quantity</th>
          <th>Min Quantity</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of filteredItems()">
          <td>{{ product.name }}</td>
          <td>{{ product.description || '-' }}</td>
          <td>{{ product.barcode }}</td>
          <td>{{ product.price | currency }}</td>
          <td>{{ product.mrp | currency }}</td>
          <td>
            <span [ngClass]="getQuantityClass(product.quantity, product.minimumQuantity)">
              {{ product.quantity }}
            </span>
          </td>
          <td>{{ product.minimumQuantity }}</td>
          <td>
            <span class="status-badge" [ngClass]="product.isActive ? 'active' : 'inactive'">
              {{ product.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-edit" (click)="editItem(product)" title="Edit">
                <mat-icon>edit</mat-icon>
              </button>
              <button class="btn-delete" (click)="deleteItem(product.id)" title="Delete">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading() && !filteredItems().length && !error()" class="retail-pro-empty">
    <div class="retail-pro-empty__icon">
      <mat-icon>shopping_cart</mat-icon>
    </div>
    <h2 class="retail-pro-empty__title">No products found</h2>
    <p class="retail-pro-empty__description">Get started by adding your first product to the inventory</p>
    <button class="retail-pro-btn retail-pro-btn--primary retail-pro-btn--large" (click)="navigateAddProduct()">
      <span class="btn-icon">+</span>
      Add Your First Product
    </button>
  </div>
</div>
