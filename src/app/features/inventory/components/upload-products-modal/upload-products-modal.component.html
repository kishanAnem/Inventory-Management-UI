<div class="upload-modal">
  <div class="modal-header">
    <h2>Import Products</h2>
    <button class="close-button" (click)="onClose()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="modal-content">
    <!-- Upload Area -->
    @if (!uploadResult()) {
      <div 
        class="upload-area"
        [class.drag-over]="isDragOver()"
        [class.has-file]="selectedFile()"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)">
        
        @if (!selectedFile()) {
          <div class="upload-prompt">
            <mat-icon class="upload-icon">cloud_upload</mat-icon>
            <h3>Drag and drop your Excel file here</h3>
            <p>or</p>
            <label class="file-select-btn">
              <input 
                type="file" 
                accept=".xlsx,.xls,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel"
                (change)="onFileSelected($event)"
                hidden>
              Browse Files
            </label>
            <p class="file-hint">Supported formats: .xlsx, .xls</p>
          </div>
        } @else {
          <div class="selected-file">
            <div class="file-info">
              <mat-icon class="file-icon">description</mat-icon>
              <div class="file-details">
                <span class="file-name">{{ selectedFile()?.name }}</span>
                <span class="file-size">{{ formatFileSize(selectedFile()?.size || 0) }}</span>
              </div>
            </div>
            <button class="remove-file-btn" (click)="removeFile()" [disabled]="isUploading()">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        }
      </div>

      <!-- Error Message -->
      @if (uploadError()) {
        <div class="error-message">
          <mat-icon>error</mat-icon>
          <span>{{ uploadError() }}</span>
        </div>
      }

      <!-- Upload Progress -->
      @if (isUploading()) {
        <div class="upload-progress">
          <mat-spinner diameter="24"></mat-spinner>
          <span>Uploading products...</span>
        </div>
      }
    }

    <!-- Upload Result -->
    @if (uploadResult()) {
      <div class="upload-result">
        <div class="result-summary">
          @if (uploadResult()!.successCount > 0) {
            <div class="result-item success">
              <mat-icon>check_circle</mat-icon>
              <span>{{ uploadResult()!.successCount }} products imported successfully</span>
            </div>
          }
          @if (uploadResult()!.failureCount > 0) {
            <div class="result-item error">
              <mat-icon>error</mat-icon>
              <span>{{ uploadResult()!.failureCount }} products failed to import</span>
            </div>
          }
        </div>

        @if (uploadResult()!.errors && uploadResult()!.errors.length > 0) {
          <div class="error-list">
            <h4>Errors:</h4>
            <ul>
              @for (error of uploadResult()!.errors; track error) {
                <li>{{ error }}</li>
              }
            </ul>
          </div>
        }
      </div>
    }
  </div>

  <div class="modal-footer">
    @if (!uploadResult()) {
      <button class="btn btn-secondary" (click)="onClose()">Cancel</button>
      <button 
        class="btn btn-primary" 
        (click)="uploadFile()" 
        [disabled]="!selectedFile() || isUploading()">
        @if (isUploading()) {
          <mat-spinner diameter="18"></mat-spinner>
          Uploading...
        } @else {
          <mat-icon>upload</mat-icon>
          Upload Products
        }
      </button>
    } @else {
      <button class="btn btn-primary" (click)="onClose()">Done</button>
    }
  </div>
</div>
